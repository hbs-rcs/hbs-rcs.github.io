<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Victoria L. Prince | HBS Research Computing Services Blog</title>
    <link>https://hbs-rcs.github.io/author/victoria-l.-prince/</link>
      <atom:link href="https://hbs-rcs.github.io/author/victoria-l.-prince/index.xml" rel="self" type="application/rss+xml" />
    <description>Victoria L. Prince</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>en-us</language><lastBuildDate>Sun, 10 Oct 2021 00:00:00 +0000</lastBuildDate>
    <image>
      <url>https://hbs-rcs.github.io/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_512x512_fill_lanczos_center_3.png</url>
      <title>Victoria L. Prince</title>
      <link>https://hbs-rcs.github.io/author/victoria-l.-prince/</link>
    </image>
    
    <item>
      <title>Specification Curve Analysis: Overview and Stata Example</title>
      <link>https://hbs-rcs.github.io/post/specification-curve-analysis/</link>
      <pubDate>Sun, 10 Oct 2021 00:00:00 +0000</pubDate>
      <guid>https://hbs-rcs.github.io/post/specification-curve-analysis/</guid>
      <description>

&lt;div id=&#34;overview&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Overview&lt;/h2&gt;
&lt;p&gt;Research reproducibility topic has been gaining momentum over the past decade. There have been many studies reporting inability to replicate published results and lack of necessary details in methods description. Some journals are addressing this issue by requiring access to study data and executable code. However, while this may provide some reassurance in reliability of the results, the actual choice of analytic methods could be shaped by many assumptions that might not be evident.&lt;/p&gt;
&lt;p&gt;There usually isn’t one correct way to analyse data. Instead, empirical studies often have plenty of flexibility in the way data are collected and cleaned as well as in the final model specification. A data cleaning step may involve exclusion of some units with missing data or conversion of a continuous variable to a categorical one or (vice versa). There also might be models equally plausible for the outcome, but having different sets of covariates or functional forms. Each of these small steps may snowball into a reported effect that is overly favorable to researchers’ narrative.&lt;/p&gt;
&lt;p&gt;A relatively novel and very promising method that can help to mitigate this issue was proposed in &lt;span class=&#34;citation&#34;&gt;&lt;a href=&#34;#ref-simonsohn2015better&#34; role=&#34;doc-biblioref&#34;&gt;Simonsohn, Simmons, and Nelson&lt;/a&gt; (&lt;a href=&#34;#ref-simonsohn2015better&#34; role=&#34;doc-biblioref&#34;&gt;2015&lt;/a&gt;)&lt;/span&gt; and is called &lt;strong&gt;Specification Curve Analysis&lt;/strong&gt; (SCA). The idea behind the method is simple - the researcher is asked to consider multiple plausible ways to analyze the data and show that, &lt;em&gt;jointly&lt;/em&gt;, the null hypothesis of no effect can be rejected. It doesn’t mean that all models must result in a statistically significant effect (though, it would make the conclusions very convincing!). However, even if the effect is detected when all specifications are tested simultaneously, this would result in a more objective inference.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;method-details&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Method Details&lt;/h2&gt;
&lt;p&gt;The method involves the following steps:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: lower-roman&#34;&gt;
&lt;li&gt;identifying the set of theoretically justified, statistically valid, and non-redundant analytic specifications;&lt;/li&gt;
&lt;li&gt;running the analysis for each specification and displaying the results graphically - this allows the readers to identify consequential specification decisions;&lt;/li&gt;
&lt;li&gt;conducting statistical tests to determine whether, as a whole, results are inconsistent with the null hypothesis.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The first two steps above are self-explanatory. However, the third step is novel. The authors (&lt;span class=&#34;citation&#34;&gt;&lt;a href=&#34;#ref-simonsohn2020specification&#34; role=&#34;doc-biblioref&#34;&gt;Simonsohn, Simmons, and Nelson&lt;/a&gt; (&lt;a href=&#34;#ref-simonsohn2020specification&#34; role=&#34;doc-biblioref&#34;&gt;2020&lt;/a&gt;)&lt;/span&gt;) proposed three test statistics for the SCA:&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;median effect estimated across all specifications;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;share of specifications that obtain a statistically significant effect in the predicted direction;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;average of Z-values across all specifications.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;For each of them a sampling distribution can be generating by “resampling under-the-null.” This involves modifying the observed data so that the null hypothesis is known to be true, and then drawing random samples of the modified data. The test statistic of interest is then computed on each of those samples. The resulting distribution is the estimated distribution of the test statistic under the null.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;available-tools&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Available Tools&lt;/h2&gt;
&lt;p&gt;There are several resources available to aid the implementation of the method. I organize them in a table below:&lt;/p&gt;
&lt;table&gt;
&lt;colgroup&gt;
&lt;col width=&#34;2%&#34; /&gt;
&lt;col width=&#34;15%&#34; /&gt;
&lt;col width=&#34;82%&#34; /&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th&gt;Language&lt;/th&gt;
&lt;th&gt;Package Name&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;R&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://masurp.github.io/specr/&#34;&gt;specr&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Available on CRAN. Provides functions to set up, run, evaluate and plot the specifications of interest. There is a lot of flexibility in model set-up. However, the package doesn’t have capability to perform the step (iii) above (i.e., the joint testing).&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;R&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://joachim-gassen.github.io/rdfanalysis/&#34;&gt;rdfanalysis&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Available only on GitHub. A more comprehensive collection of functions that provides a self-documenting code base that allows researchers to systematically document and explore their researcher degrees of freedom when conducting analyses. Has a shiny front end that helps to explore the findings interactively.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Stata&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/martin-andresen/speccurve&#34;&gt;speccurve&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;One function that can only plot the curve using coefficients stored in the &lt;strong&gt;e()&lt;/strong&gt;-returns. Requires setting up and looping through the models beforehand.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Stata&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/mgao6767/specurve&#34;&gt;specurve&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Depends on Stata 16’s Python (v.3.6) integration and several additional Python modules. The function performs regressions as specified in a provided YAML-formatted file and plots the specification curve. Limited to &lt;code&gt;reghdfe&lt;/code&gt; models only, but allows for various combinations of fixed effects and clustering.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Stata&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/bbdaniels/specc&#34;&gt;specc&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Available on &lt;a href=&#34;https://econpapers.repec.org/software/bocbocode/s458720.htm&#34;&gt;SSC&lt;/a&gt; and is open for development on GitHub. The package appears to be very flexible in setting up models and enumerating specifications as well as plotting the curve. However, it lacks a simple example to get started.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr class=&#34;even&#34;&gt;
&lt;td&gt;Python&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/aeturrell/specification_curve&#34;&gt;specification_curve&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Allows to conduct analysis and plot specification curves. Flexible in model specification and very well &lt;a href=&#34;https://specification-curve.readthedocs.io/en/latest/&#34;&gt;documented&lt;/a&gt;. While it also can’t perform the joint test (step (iii) of the specification analysis), the author has an example of its manual implementation &lt;a href=&#34;http://aeturrell.com/2019/01/25/Specification-Curve-Analysis/&#34;&gt;here&lt;/a&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;It looks like most major statistical programming language have some version of the specification curve implemented. However, as far as I can tell, none of them are capable of performing step (iii), which, arguably, is as important as the curve itself. Therefore, for now, researches have to implement it themselves or contact RCS (research@hbs.edu) for assistance!&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;stata-example&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Stata Example&lt;/h2&gt;
&lt;p&gt;Next, I show an example in Stata that loops through several model specifications and then uses the &lt;a href=&#34;https://github.com/martin-andresen/speccurve&#34;&gt;speccurve&lt;/a&gt; function in Stata to plot the curve. Before running this code, make sure that the function is installed in Stata by running the following line:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;net install speccurve, from(&#34;https://raw.githubusercontent.com/martin-andresen/speccurve/master&#34;)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The code uses a classic &lt;code&gt;auto&lt;/code&gt; data set and specifies several regression models that predict car price using available characteristics. The effect of interest is the coefficient estimated for the indicator &lt;code&gt;foreign&lt;/code&gt;.&lt;/p&gt;
&lt;pre class=&#34;stata&#34;&gt;&lt;code&gt;clear all
sysuse auto, clear

loc no=0

* enumerationg many different specifications using a loop
foreach m in &amp;quot;&amp;quot; &amp;quot;mpg&amp;quot; {
    foreach tr in &amp;quot;&amp;quot; &amp;quot;trunk&amp;quot; {
        foreach wt in &amp;quot;&amp;quot; &amp;quot;weight&amp;quot; {
            foreach ln in &amp;quot;&amp;quot; &amp;quot;length&amp;quot; {
                foreach hr in &amp;quot;&amp;quot; &amp;quot;headroom&amp;quot; {
                    qui reg price foreign `m&amp;#39; `tr&amp;#39; `wt&amp;#39; `ln&amp;#39; `hr&amp;#39;
                  eststo md`no&amp;#39;
                    loc ++no
                }
            }
        }
    }
}

* plotting a SC with foreign as a parameter of interest
speccurve *, param(foreign) controls title(SCA for the effect of foreigh)
graph export &amp;quot;speccurve1.svg&amp;quot;, replace&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;(1978 Automobile Data)




(file speccurve1.svg written in SVG format)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The code above produced the following specification curve:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;speccurve1.svg&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Looks like including the &lt;code&gt;weight&lt;/code&gt; variable in the model had a notable effect on the coefficient for &lt;code&gt;foreign&lt;/code&gt;. Function &lt;code&gt;speccurve&lt;/code&gt; is somewhat limited in that it doesn’t work with models that have factors as controls. Next, I show a workaround for the latter case:&lt;/p&gt;
&lt;pre class=&#34;stata&#34;&gt;&lt;code&gt;clear all
sysuse auto, clear

egen headroom_c = group(headroom)
loc no=0

foreach m in &amp;quot;&amp;quot; &amp;quot;mpg&amp;quot; {
    foreach tr in &amp;quot;&amp;quot; &amp;quot;trunk&amp;quot; {
        foreach wt in &amp;quot;&amp;quot; &amp;quot;weight&amp;quot; {
            foreach ln in &amp;quot;&amp;quot; &amp;quot;length&amp;quot; {
                foreach hr in &amp;quot;&amp;quot; &amp;quot;headroom&amp;quot; &amp;quot;i.headroom_c&amp;quot;{
                    qui reg price foreign `m&amp;#39; `tr&amp;#39; `wt&amp;#39; `ln&amp;#39; `hr&amp;#39;
                    
                    qui estadd scalar mpgv = 0, replace
                    qui estadd scalar trunkv = 0, replace
                    qui estadd scalar weightv = 0, replace
                    qui estadd scalar lengthv = 0, replace
                    foreach vr in m tr wt ln {
                        if &amp;quot;``vr&amp;#39;&amp;#39;&amp;quot;!=&amp;quot;&amp;quot; qui estadd scalar ``vr&amp;#39;&amp;#39;v = 1, replace
                    }
                    
                    qui estadd scalar headroomv = 0
                    qui estadd scalar iheadroom_cv = 0
                    local vname = subinstr(&amp;quot;`hr&amp;#39;&amp;quot;, &amp;quot;.&amp;quot;, &amp;quot;&amp;quot;, .)
                    qui estadd scalar `vname&amp;#39;v = 1, replace 
                    
                    eststo md`no&amp;#39;
                    loc ++no
                }
            }
        }
    }
}

* The code below produces an error:
*speccurve *, param(foreign) controls title(SCA for the effect of foreigh)

* Workaround:
speccurve *, param(foreign) level(95) graphopts(legend(pos(1))) title(SCA for auto dataset) panel(mpgv trunkv weightv lengthv headroomv iheadroom_cv)
graph export &amp;quot;speccurve2.svg&amp;quot;, replace&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;(1978 Automobile Data)





(file speccurve2.svg written in SVG format)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The code implements models that have &lt;code&gt;headroom&lt;/code&gt; included as a factor or as a continuous variable. Note that the first call for &lt;code&gt;speccurve&lt;/code&gt; would produce an error due to a bug in the function. However, the second call produces the following specification curve:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;speccurve2.svg&#34; /&gt;&lt;/p&gt;
&lt;p&gt;One can also output a table with numerical results:&lt;/p&gt;
&lt;pre class=&#34;stata&#34;&gt;&lt;code&gt;matlist r(table)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;             |    specno    modelno   estimate      min95      max95       mpgv     trunkv    weightv    lengthv  headroomv  iheadro~v 
-------------+-------------------------------------------------------------------------------------------------------------------------
         md0 |         1          1   312.2587  -1191.708   1816.225          0          0          0          0          0          0 
         md2 |         2          3    364.925  -1419.362   2149.212          0          0          0          0          0          1 
         md1 |         3          2   577.8125  -992.5493   2148.174          0          0          0          0          1          0 
        md14 |         4         15   740.7716  -960.3329   2441.876          0          1          0          0          0          1 
        md13 |         5         14   1128.818  -393.3118   2650.948          0          1          0          0          1          0 
        md12 |         6         13   1190.155  -326.8468   2707.157          0          1          0          0          0          0 
        md26 |         7         27   1327.396  -294.4929   2949.285          1          0          0          0          0          1 
        md38 |         8         39   1376.011  -230.2271   2982.249          1          1          0          0          0          1 
        md25 |         9         26   1714.109   292.4855   3135.733          1          0          0          0          1          0 
        md24 |        10         25   1767.292   371.2169   3163.368          1          0          0          0          0          0 
        md37 |        11         38   1825.733   408.1118   3243.355          1          1          0          0          1          0 
        md36 |        12         37   1887.461   468.5866   3306.335          1          1          0          0          0          0 
        md41 |        13         42   2196.194   517.1768   3875.212          1          1          0          1          0          1 
        md29 |        14         30   2247.635   591.1235   3904.146          1          0          0          1          0          1 
        md17 |        15         18   2294.095   616.0623   3972.129          0          1          0          1          0          1 
         md5 |        16          6   2352.064   696.5941   4007.534          0          0          0          1          0          1 
        md40 |        17         41   2615.666   1084.272   4147.059          1          1          0          1          1          0 
        md27 |        18         28   2644.771   1125.227   4164.315          1          0          0          1          0          0 
        md28 |        19         29   2644.847   1133.077   4156.616          1          0          0          1          1          0 
        md39 |        20         40   2670.519   1133.691   4207.347          1          1          0          1          0          0 
        md16 |        21         17   2774.021   1233.682   4314.361          0          1          0          1          1          0 
         md3 |        22          4   2801.143   1273.549   4328.737          0          0          0          1          0          0 
         md4 |        23          5   2801.899   1281.258    4322.54          0          0          0          1          1          0 
        md15 |        24         16   2827.236    1282.39   4372.082          0          1          0          1          0          0 
        md23 |        25         24   3072.365   1665.236   4479.495          0          1          1          1          0          1 
        md47 |        26         48   3079.179   1643.422   4514.937          1          1          1          1          0          1 
        md20 |        27         21   3116.728   1652.392   4581.064          0          1          1          0          0          1 
         md8 |        28          9   3132.815    1688.75    4576.88          0          0          1          0          0          1 
        md11 |        29         12   3146.808   1750.304   4543.312          0          0          1          1          0          1 
        md35 |        30         36   3148.211   1721.962   4574.459          1          0          1          1          0          1 
        md44 |        31         45   3162.517   1671.851   4653.184          1          1          1          0          0          1 
        md32 |        32         33   3179.193   1706.637   4651.749          1          0          1          0          0          1 
        md46 |        33         47   3502.516   2193.975   4811.056          1          1          1          1          1          0 
        md22 |        34         23    3526.83   2250.662   4802.999          0          1          1          1          1          0 
        md34 |        35         35   3545.345   2248.433   4842.256          1          0          1          1          1          0 
        md33 |        36         34   3550.194   2242.594   4857.793          1          0          1          1          0          0 
        md45 |        37         46   3557.085     2235.3   4878.871          1          1          1          1          0          0 
        md10 |        38         11   3570.379   2305.781   4834.976          0          0          1          1          1          0 
         md9 |        39         10   3573.092   2297.992   4848.191          0          0          1          1          0          0 
        md21 |        40         22   3580.051   2290.845   4869.256          0          1          1          1          0          0 
         md7 |        41          8    3623.75   2316.374   4931.127          0          0          1          0          1          0 
        md19 |        42         20   3631.585    2310.07   4953.101          0          1          1          0          1          0 
         md6 |        43          7   3637.001   2303.885   4970.118          0          0          1          0          0          0 
        md31 |        44         32   3648.619   2310.079   4987.159          1          0          1          0          1          0 
        md43 |        45         44   3654.777   2302.875   5006.679          1          1          1          0          1          0 
        md30 |        46         31    3673.06   2308.909   5037.212          1          0          1          0          0          0 
        md18 |        47         19   3686.447   2352.692   5020.201          0          1          1          0          0          0 
        md42 |        48         43   3711.123   2346.938   5075.308          1          1          1          0          0          0 &lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;references&#34; class=&#34;section level2 unnumbered&#34;&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;div id=&#34;refs&#34; class=&#34;references csl-bib-body hanging-indent&#34;&gt;
&lt;div id=&#34;ref-simonsohn2015better&#34; class=&#34;csl-entry&#34;&gt;
Simonsohn, Uri, Joseph P Simmons, and Leif D Nelson. 2015. &lt;span&gt;“Better p-Curves: Making p-Curve Analysis More Robust to Errors, Fraud, and Ambitious p-Hacking, a Reply to Ulrich and Miller (2015).”&lt;/span&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-simonsohn2020specification&#34; class=&#34;csl-entry&#34;&gt;
———. 2020. &lt;span&gt;“Specification Curve Analysis.”&lt;/span&gt; &lt;em&gt;Nature Human Behaviour&lt;/em&gt; 4 (11): 1208–14.
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Synthetic Controls: brief overview with practical recommmendations</title>
      <link>https://hbs-rcs.github.io/post/synthetic-controls/</link>
      <pubDate>Thu, 12 Sep 2019 00:00:00 +0000</pubDate>
      <guid>https://hbs-rcs.github.io/post/synthetic-controls/</guid>
      <description>
&lt;script src=&#34;https://hbs-rcs.github.io/post/synthetic-controls/index_files/header-attrs/header-attrs.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;Recently, I found myself researching the latest developments on the topic of Synthetic Controls (SC) for one of the projects. I had the pleasure of learning about the method from its co-author &lt;a href=&#34;https://web.stanford.edu/~jhain/&#34;&gt;Prof. Jens Hainmueller&lt;/a&gt; back in 2011, when it had just started gaining momentum. Wondering what new insights have been gathered over the last 8 years by applied researchers utilizing this method for causal inference problems, I outlined interesting highlights in this post.
&lt;!-- In another post I give an annotated Stata example of automating the method for more than one treated unit. --&gt;&lt;/p&gt;
&lt;div id=&#34;overview&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Overview&lt;/h2&gt;
&lt;p&gt;The method was first introduced in &lt;span class=&#34;citation&#34;&gt;Abadie and Gardeazabal (&lt;a href=&#34;#ref-Abadie_Economic_Costs_2003&#34; role=&#34;doc-biblioref&#34;&gt;2003&lt;/a&gt;)&lt;/span&gt; to estimate a causal effect of a political conflict on region’s per capita GDP. In the spirit of classical matching methods for causal inference (&lt;span class=&#34;citation&#34;&gt;Rosenbaum (&lt;a href=&#34;#ref-rosenbaum2002overt&#34; role=&#34;doc-biblioref&#34;&gt;2002&lt;/a&gt;)&lt;/span&gt;), the authors proposed a procedure for finding a group of control regions such that their &lt;em&gt;weighted average&lt;/em&gt; would match the specified pre-intervention characteristics (including the evolution of the outcome) of the affected region.&lt;/p&gt;
&lt;p&gt;Here is a more technical description: suppose that we observe &lt;span class=&#34;math inline&#34;&gt;\(J+1\)&lt;/span&gt; units in time periods &lt;span class=&#34;math inline&#34;&gt;\(1,2,..., T\)&lt;/span&gt; and unit #1 is exposed to the intervention during periods &lt;span class=&#34;math inline&#34;&gt;\(T_0+1, ...,T\)&lt;/span&gt;. Let &lt;span class=&#34;math inline&#34;&gt;\(Y^C_{jt}\)&lt;/span&gt; be the outcome that would be observed (i.e., the &lt;a href=&#34;https://en.wikipedia.org/wiki/Rubin_causal_model&#34;&gt;potential outcome&lt;/a&gt;) for unit &lt;span class=&#34;math inline&#34;&gt;\(j\)&lt;/span&gt; at time &lt;span class=&#34;math inline&#34;&gt;\(t\)&lt;/span&gt; in the absence of the intervention. For units 2 through &lt;span class=&#34;math inline&#34;&gt;\(J+1\)&lt;/span&gt;, the observed outcome &lt;span class=&#34;math inline&#34;&gt;\(Y_{jt}\)&lt;/span&gt; is equivalent to &lt;span class=&#34;math inline&#34;&gt;\(Y^C_{jt}\)&lt;/span&gt;. On the other hand, let &lt;span class=&#34;math inline&#34;&gt;\(Y^I_{jt}\)&lt;/span&gt; be the potential outcome under the intervention. Therefore, &lt;span class=&#34;math inline&#34;&gt;\(Y_{1t}=Y^I_{1t}\)&lt;/span&gt; for &lt;span class=&#34;math inline&#34;&gt;\(t=T_0+1, ...,T\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Our goal is to estimate the &lt;em&gt;causal treatment effect on the treated&lt;/em&gt; unit:
&lt;span class=&#34;math display&#34;&gt;\[
\alpha_{1t} = Y^I_{jt} - Y^C_{jt}, \text{for } t=T_0+1,..., T.
\]&lt;/span&gt;
Suppose we also observe a vector of &lt;span class=&#34;math inline&#34;&gt;\(R\)&lt;/span&gt; covariates for each unit &lt;span class=&#34;math inline&#34;&gt;\(j\)&lt;/span&gt;, &lt;span class=&#34;math inline&#34;&gt;\(\textbf{Z}_j\)&lt;/span&gt;, that are &lt;em&gt;predictive of the outcome&lt;/em&gt; and “unaffected by the treatment”. The SC method assumes that we are able to find a set of nonnegative weights &lt;span class=&#34;math inline&#34;&gt;\(\textbf{W}=(w_2,...,w_{J+1})&amp;#39;\)&lt;/span&gt; that sum up to 1 and satisfy the following &lt;span class=&#34;math inline&#34;&gt;\((R+T_0)\)&lt;/span&gt; conditions &lt;em&gt;exactly&lt;/em&gt;:
&lt;span class=&#34;math display&#34;&gt;\[
\sum_{j=2}^{J+1}w_j\textbf{Z}_j=\textbf{Z}_1\text{ and }\sum_{j=2}^{J+1}w_jY_{jt}=Y_{1t}, \text{ for }t=1,...,T_0.
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In practice, of course, it is unlikely that we would find exact matches for all available characteristics. Therefore, we find weights that minimize a chosen measure of discrepancy. Let &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}_1\)&lt;/span&gt; be a &lt;span class=&#34;math inline&#34;&gt;\((R+T_0)\times 1\)&lt;/span&gt; vector of pre-intervention characteristics for the treated unit. Similarly, &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}_0\)&lt;/span&gt; is a &lt;span class=&#34;math inline&#34;&gt;\((R+T_0) \times J\)&lt;/span&gt; matrix of the same variables for the donor pool. The original paper (&lt;span class=&#34;citation&#34;&gt;Abadie, Diamond, and Hainmueller (&lt;a href=&#34;#ref-abadie2010synthetic&#34; role=&#34;doc-biblioref&#34;&gt;2010&lt;/a&gt;)&lt;/span&gt;) minimizes the following distance measure:
&lt;span class=&#34;math display&#34;&gt;\[
||\textbf{X}_1-\textbf{X}_0\textbf{W}||_{\textbf{V}} = \sqrt{(\textbf{X}_1-\textbf{X}_0\textbf{W})&amp;#39;\textbf{V}(\textbf{X}_1-\textbf{X}_0\textbf{W})} \qquad\qquad(1)
\]&lt;/span&gt;
In words, SC calculation produces two outputs: matrix &lt;span class=&#34;math inline&#34;&gt;\(\textbf{V}\)&lt;/span&gt;, which weighs variables included in the minimization differently depending on how well they predict pre-intervention outcomes, and an array of weights &lt;span class=&#34;math inline&#34;&gt;\(\textbf{W}\)&lt;/span&gt; for control units.&lt;/p&gt;
&lt;p&gt;There are various ways to choose &lt;span class=&#34;math inline&#34;&gt;\(\textbf{V}\)&lt;/span&gt;, including subjective assessment of predictive power of &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}\)&lt;/span&gt;, regression, minimize prediction error, or cross-validation. When &lt;span class=&#34;math inline&#34;&gt;\(\textbf{V}\)&lt;/span&gt; is set to &lt;span class=&#34;math inline&#34;&gt;\(\textbf{I}\)&lt;/span&gt;, the identity matrix, then all characteristics are assumed to have equal weights, and the distance defined in (1) can be interpreted as the usual Euclidean distance between points &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}_1\)&lt;/span&gt; and &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}_0\textbf{W}\)&lt;/span&gt; on a &lt;span class=&#34;math inline&#34;&gt;\((R+T_0)\)&lt;/span&gt;-dimensional space.&lt;/p&gt;
&lt;p&gt;Note that, once we have a synthetic control for the treated unit, the method permits estimation of a treatment effect for each post-treatment time period &lt;span class=&#34;math inline&#34;&gt;\(t=T_0+1,..., T\)&lt;/span&gt;, as long as we observe the corresponding outcome for all controls. However, it is more common to report an aggregated post-treatment effect, e.g., &lt;span class=&#34;math inline&#34;&gt;\(\sum_{t=T_0+1}^T \alpha_{1t}/(T-T_0)\)&lt;/span&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;features-and-limitations&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Features and Limitations&lt;/h2&gt;
&lt;p&gt;There are several attractive features of the SC method:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;It provides a systematic data-driven way of assigning weights to control units to provide a close synthetic match to a treated unit, especially if none of the observed control units fit the bill.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;When potential outcomes are related linearly to observed and unobserved covariates (or &lt;em&gt;factors&lt;/em&gt;), &lt;span class=&#34;citation&#34;&gt;Abadie, Diamond, and Hainmueller (&lt;a href=&#34;#ref-abadie2010synthetic&#34; role=&#34;doc-biblioref&#34;&gt;2010&lt;/a&gt;)&lt;/span&gt; showed that the estimated causal effect is unbiased even when there are unobserved confounding factors that vary with time (though, this feature as well as many other theoretical properties of the SC method rely on availability of a &lt;em&gt;large number of preintervention outcomes&lt;/em&gt;.)&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;There is an &lt;em&gt;interesting parallel between a linear regression and the SC method&lt;/em&gt;: it turns out that, when estimating a counterfactual outcome using a naive regression approach, i.e., regressing &lt;span class=&#34;math inline&#34;&gt;\(Y_{jt}\)&lt;/span&gt; on &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}_0\)&lt;/span&gt; post-treatment for controls (&lt;span class=&#34;math inline&#34;&gt;\(t=T_0,...,T\)&lt;/span&gt;, &lt;span class=&#34;math inline&#34;&gt;\(j=2,...,J\)&lt;/span&gt;) and then using this model together with &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}_1\)&lt;/span&gt; to predict &lt;span class=&#34;math inline&#34;&gt;\(Y^C_{1t}\)&lt;/span&gt;, we can also rewrite the result as a linear combination of untreated units (see &lt;span class=&#34;citation&#34;&gt;Abadie, Diamond, and Hainmueller (&lt;a href=&#34;#ref-abadie2015comparative&#34; role=&#34;doc-biblioref&#34;&gt;2015&lt;/a&gt;)&lt;/span&gt; for a proof) with weights that sum up to one. However, a conceptual difference lies in the fact that regression weights are &lt;em&gt;unrestricted&lt;/em&gt; - they may be negative or greater than one. “As a result, estimates of counterfactuals based on linear regression may extrapolate beyond the support of comparison units.” In fact, as suggested in &lt;span class=&#34;citation&#34;&gt;Abadie, Diamond, and Hainmueller (&lt;a href=&#34;#ref-abadie2015comparative&#34; role=&#34;doc-biblioref&#34;&gt;2015&lt;/a&gt;)&lt;/span&gt;, one way to assess the extent of the extrapolation is to calculate the regression weights explicitly!&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;It can be shown that the SC method is a special case of a “sideways” Lasso regression with a fixed value of its threshold parameter to &lt;span class=&#34;math inline&#34;&gt;\(1\)&lt;/span&gt; and an additional restriction on coefficients to be nonnegative and sum up to one (&lt;span class=&#34;citation&#34;&gt;Kinn (&lt;a href=&#34;#ref-kinn2018synthetic&#34; role=&#34;doc-biblioref&#34;&gt;2018&lt;/a&gt;)&lt;/span&gt;). The “sideways” regression refers to one where units are acting as covariates, and the time periods (and covariates &lt;span class=&#34;math inline&#34;&gt;\(\textbf{Z}\)&lt;/span&gt;) serve as new “units” (e.g., observation &lt;span class=&#34;math inline&#34;&gt;\(Y_{1t}\)&lt;/span&gt; is regressed on &lt;span class=&#34;math inline&#34;&gt;\(Y_{2t}, \dots, Y_{(J+1)t}\)&lt;/span&gt; for &lt;span class=&#34;math inline&#34;&gt;\(t=1, \dots, T_0\)&lt;/span&gt;).&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The SC method was originally developed for one treated unit. However, if multiple units are affected by the event of interest, the method can be applied to each unit separately and the treatment effect summarized by computing an Average Treatment Effect on the Treated (ATT) as demonstrated in &lt;span class=&#34;citation&#34;&gt;Kreif et al. (&lt;a href=&#34;#ref-kreif2016examination&#34; role=&#34;doc-biblioref&#34;&gt;2016&lt;/a&gt;)&lt;/span&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- An example of this procedure in Stata is shown here. --&gt;
&lt;/div&gt;
&lt;div id=&#34;practical-recommendations&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Practical Recommendations&lt;/h2&gt;
&lt;p&gt;The topic of SCs is still an active area of research appearing regularly in methodological and applied papers. Here are some useful tips that I came across while going over the literature:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;There are many (sometimes, conflicting!) recommendations on what should be included as part of &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}_0\)&lt;/span&gt; and &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}_1\)&lt;/span&gt;, and I think the jury is still out. Of course, there is no doubt that the chosen covariates should be predictive of the outcome. That said, it is a bit less apparent how to strike a balance between the length of the pretreatment outcome window and a set of background characteristics that should be used to construct &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}\)&lt;/span&gt; matrices.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;On one hand, many theoretical properties of the procedure were derived asymptotically, assuming infinite pretreatment window. Moreover, &lt;span class=&#34;citation&#34;&gt;Botosaru and Ferman (&lt;a href=&#34;#ref-botosaru2019covariates&#34; role=&#34;doc-biblioref&#34;&gt;2019&lt;/a&gt;)&lt;/span&gt; show that a “perfect balance on pre-treatment outcomes does not generally imply an approximate balance for all covariates, even when they are all relevant”, concluding that, “although there may be advantages to balancing on covariates to construct the SC estimator, a perfect balance on covariates should not be required for the SC method as long as there is a perfect balance on a long set of pre-treatment outcomes.”&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;On the other hand &lt;span class=&#34;citation&#34;&gt;Kaul et al. (&lt;a href=&#34;#ref-kaul2015synthetic&#34; role=&#34;doc-biblioref&#34;&gt;2015&lt;/a&gt;)&lt;/span&gt; argues that one should not use covariates simultaneously with &lt;em&gt;all&lt;/em&gt; available preintervention outcomes, as, under certain conditions, this may renders covariates to be irrelevant. With that, &lt;span class=&#34;citation&#34;&gt;Abadie, Diamond, and Hainmueller (&lt;a href=&#34;#ref-abadie2015comparative&#34; role=&#34;doc-biblioref&#34;&gt;2015&lt;/a&gt;)&lt;/span&gt; states that “it is of crucial importance that synthetic controls closely reproduce the values that variables with a large predictive power on the outcome of interest take for the unit affected by the intervention.” Thus, it is important that the chosen covariates are allowed to influence the estimated synthetic control.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;One should always inspect the quality of the match and discard synthetic controls that do not closely trace the preintervention outcome. However, there is still debate whether a perfect balance on pre-treatment covariates is strictly necessary (&lt;span class=&#34;citation&#34;&gt;Botosaru and Ferman (&lt;a href=&#34;#ref-botosaru2017role&#34; role=&#34;doc-biblioref&#34;&gt;2017&lt;/a&gt;)&lt;/span&gt;).&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;span class=&#34;citation&#34;&gt;Abadie, Diamond, and Hainmueller (&lt;a href=&#34;#ref-abadie2010synthetic&#34; role=&#34;doc-biblioref&#34;&gt;2010&lt;/a&gt;)&lt;/span&gt; emphasizes that SC method should be avoided in cases where the treated unit lies outside the distribution of control units. In other words, values of pretreatment variables for the affected unit cannot be outside any linear combination of the donor pool values. If no convex combination of control units can reconstruct the treated unit then counterfactual estimates could be severely biased. In practice, one can start with inspecting the ranges of outcomes and covariates during the pre-treatment period among controls and making sure that they at least overlap with those for the treated unit.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;In addition to the extrapolation issues, we should watch out for possible interpolation bias by making sure that the variables used to compute the weights have values among the donor pool units that are similar to those observed for the affected unit. To reduce interpolation biases, it is recommended to restrict the donor pool to units that are “similar” to the treated one(s).&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Implicit in the notation above is the usual assumption of &lt;em&gt;no interference&lt;/em&gt; between units - or that outcomes of the untreated units are not affected by the intervention implemented in the treated unit. For example, the policy in the affected region cannot affect the outcome in the pool of donor regions.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Finally, when dealing with multiple outcomes, a procedure that uses distance measure given in (1) will likely construct a different synthetic control for each outcome, even if the same set of pretreatment characteristics is being matched on. This is due to the fact that the weighting matrix &lt;span class=&#34;math inline&#34;&gt;\(\textbf{V}\)&lt;/span&gt; is computed separately for each outcome. If we preset &lt;span class=&#34;math inline&#34;&gt;\(\textbf{V}\)&lt;/span&gt; to an identity (or any other positive-definite) matrix and use the same pretreatment outcome values to construct &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}_0\)&lt;/span&gt; and &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}_1\)&lt;/span&gt;, the same synthetic control will be constructed for each unit regardless of the outcome considered.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;As a special case, if &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}_0\)&lt;/span&gt; and &lt;span class=&#34;math inline&#34;&gt;\(\textbf{X}_1\)&lt;/span&gt; do not contain any pretreatment characteristics, setting &lt;span class=&#34;math inline&#34;&gt;\(\textbf{V}\)&lt;/span&gt; to &lt;span class=&#34;math inline&#34;&gt;\(\textbf{I}\)&lt;/span&gt; would imply that we assume that all pretreatment outcome lags affect post-treatment values equally.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This list is by no means exhaustive. I’m sure, as the SC method matures, our understanding of its strengths and limitations as well as advice on practical implementation will continue evolving.&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;references&#34; class=&#34;section level2 unnumbered&#34;&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;div id=&#34;refs&#34; class=&#34;references csl-bib-body hanging-indent&#34;&gt;
&lt;div id=&#34;ref-abadie2010synthetic&#34; class=&#34;csl-entry&#34;&gt;
Abadie, Alberto, Alexis Diamond, and Jens Hainmueller. 2010. &lt;span&gt;“Synthetic Control Methods for Comparative Case Studies: Estimating the Effect of Californias Tobacco Control Program.”&lt;/span&gt; &lt;em&gt;Journal of the American Statistical Association&lt;/em&gt; 105 (490): 493–505.
&lt;/div&gt;
&lt;div id=&#34;ref-abadie2015comparative&#34; class=&#34;csl-entry&#34;&gt;
———. 2015. &lt;span&gt;“Comparative Politics and the Synthetic Control Method.”&lt;/span&gt; &lt;em&gt;American Journal of Political Science&lt;/em&gt; 59 (2): 495–510.
&lt;/div&gt;
&lt;div id=&#34;ref-Abadie_Economic_Costs_2003&#34; class=&#34;csl-entry&#34;&gt;
Abadie, Alberto, and Javier Gardeazabal. 2003. &lt;span&gt;“The Economic Costs of Conflict: A Case Study of the Basque Country.”&lt;/span&gt; &lt;em&gt;American Economic Review&lt;/em&gt; 93 (1): 113–32. &lt;a href=&#34;https://doi.org/10.1257/000282803321455188&#34;&gt;https://doi.org/10.1257/000282803321455188&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&#34;ref-botosaru2017role&#34; class=&#34;csl-entry&#34;&gt;
Botosaru, Irene, and Bruno Ferman. 2017. &lt;span&gt;“On the Role of Covariates in the Synthetic Control Method.”&lt;/span&gt; &lt;a href=&#34;https://mpra.ub.uni-muenchen.de/81940/&#34;&gt;https://mpra.ub.uni-muenchen.de/81940/&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&#34;ref-botosaru2019covariates&#34; class=&#34;csl-entry&#34;&gt;
———. 2019. &lt;span&gt;“&lt;span class=&#34;nocase&#34;&gt;On the role of covariates in the synthetic control method&lt;/span&gt;.”&lt;/span&gt; &lt;em&gt;The Econometrics Journal&lt;/em&gt; 22 (2): 117–30. &lt;a href=&#34;https://doi.org/10.1093/ectj/utz001&#34;&gt;https://doi.org/10.1093/ectj/utz001&lt;/a&gt;.
&lt;/div&gt;
&lt;div id=&#34;ref-kaul2015synthetic&#34; class=&#34;csl-entry&#34;&gt;
Kaul, Ashok, Stefan Klößner, Gregor Pfeifer, and Manuel Schieler. 2015. &lt;span&gt;“Synthetic Control Methods: Never Use All Pre-Intervention Outcomes Together with Covariates.”&lt;/span&gt;
&lt;/div&gt;
&lt;div id=&#34;ref-kinn2018synthetic&#34; class=&#34;csl-entry&#34;&gt;
Kinn, Daniel. 2018. &lt;span&gt;“Synthetic Control Methods and Big Data.”&lt;/span&gt; &lt;em&gt;arXiv Preprint arXiv:1803.00096&lt;/em&gt;.
&lt;/div&gt;
&lt;div id=&#34;ref-kreif2016examination&#34; class=&#34;csl-entry&#34;&gt;
Kreif, Noémi, Richard Grieve, Dominik Hangartner, Alex James Turner, Silviya Nikolova, and Matt Sutton. 2016. &lt;span&gt;“Examination of the Synthetic Control Method for Evaluating Health Policies with Multiple Treated Units.”&lt;/span&gt; &lt;em&gt;Health Economics&lt;/em&gt; 25 (12): 1514–28.
&lt;/div&gt;
&lt;div id=&#34;ref-rosenbaum2002overt&#34; class=&#34;csl-entry&#34;&gt;
Rosenbaum, Paul R. 2002. &lt;span&gt;“Overt Bias in Observational Studies.”&lt;/span&gt; In &lt;em&gt;Observational Studies&lt;/em&gt;, 71–104. Springer.
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Web Scraping in R</title>
      <link>https://hbs-rcs.github.io/post/2019-08-08-web-scraping-in-r/</link>
      <pubDate>Thu, 08 Aug 2019 00:00:00 +0000</pubDate>
      <guid>https://hbs-rcs.github.io/post/2019-08-08-web-scraping-in-r/</guid>
      <description>


&lt;p&gt;Let’s walk through some steps for web scraping with R. On &lt;a href=&#34;https://en.wikipedia.org/wiki/Visa_requirements_for_United_States_citizens&#34;&gt;this Wikipedia page&lt;/a&gt; there is a table of visa requirements that I want to scrape. Let’s use the &lt;a href=&#34;https://github.com/hadley/rvest&#34;&gt;rvest&lt;/a&gt; package to get the HTML associated with that page:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(rvest)

html &amp;lt;- read_html(&amp;quot;https://en.wikipedia.org/wiki/Visa_requirements_for_United_States_citizens&amp;quot;)
html&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## {html_document}
## &amp;lt;html class=&amp;quot;client-nojs&amp;quot; lang=&amp;quot;en&amp;quot; dir=&amp;quot;ltr&amp;quot;&amp;gt;
## [1] &amp;lt;head&amp;gt;\n&amp;lt;meta http-equiv=&amp;quot;Content-Type&amp;quot; content=&amp;quot;text/html; charset= ...
## [2] &amp;lt;body class=&amp;quot;mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-sub ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now let’s use the &lt;code&gt;html_nodes()&lt;/code&gt; function to extract the table of interest. I used Chrome’s Developer Tools to get the XPath of the table (see notes at the end of the post on how to do it):&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;referenced_by &amp;lt;- html_node(html, xpath=&amp;#39;//*[@id=&amp;quot;mw-content-text&amp;quot;]/div/table[1]&amp;#39;)
referenced_by&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## {html_node}
## &amp;lt;table class=&amp;quot;sortable wikitable&amp;quot;&amp;gt;
## [1] &amp;lt;tbody&amp;gt;\n&amp;lt;tr&amp;gt;\n&amp;lt;th style=&amp;quot;width:18%;&amp;quot;&amp;gt;Country\n&amp;lt;/th&amp;gt;\n&amp;lt;th style=&amp;quot;wid ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now let’s convert that HTML table into a data frame.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;visa_requirements &amp;lt;- html_table(referenced_by)
head(visa_requirements[,1:3])&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##               Country          Visa requirement     Allowed stay
## 1         Afghanistan       Visa required[2][3]                 
## 2             Albania   Visa not required[5][6]        1 year[7]
## 3             Algeria       Visa required[8][9]                 
## 4             Andorra     Visa not required[10] 3 months[11][12]
## 5              Angola         eVisa[13][14][15]          30 days
## 6 Antigua and Barbuda Visa not required[18][19]     6 months[20]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Finally, we can clean footnote references from columns 2 and 3 using &lt;code&gt;gsub()&lt;/code&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;visa_requirements &amp;lt;- html_table(referenced_by)
visa_requirements$`Visa requirement` &amp;lt;- gsub(&amp;quot;\\[.*&amp;quot;,&amp;quot;&amp;quot;,visa_requirements$`Visa requirement`)
visa_requirements$`Allowed stay` &amp;lt;-  gsub(&amp;quot;\\[.*&amp;quot;,&amp;quot;&amp;quot;,visa_requirements$`Allowed stay`)
head(visa_requirements[,1:3])&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##               Country  Visa requirement Allowed stay
## 1         Afghanistan     Visa required             
## 2             Albania Visa not required       1 year
## 3             Algeria     Visa required             
## 4             Andorra Visa not required     3 months
## 5              Angola             eVisa      30 days
## 6 Antigua and Barbuda Visa not required     6 months&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We’ve only scratched the surface here, but hope this example shows off the convenience of the &lt;code&gt;rvest&lt;/code&gt; package.&lt;/p&gt;
&lt;p&gt;Notes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Chrome’s Developer Tools can be launched by right-clicking on the page and selecting Inspect. Then, mouse over the html code listed under elements and find a place that highlights the table of interest on the right. Then right-click again, select Copy -&amp;gt; Copy XPath.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;If writing custom scraping scripts in R is not the route you’d want to take, our team has recently discovered a very nice and flexible commercial tool &lt;a href=&#34;https://www.mozenda.com/&#34;&gt;Mozenda&lt;/a&gt;. As of 8/8/2019, they offer a 30-day trial of a full product.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>
